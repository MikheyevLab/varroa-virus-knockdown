---
title: "Varroa virus knockdows"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries}
suppressPackageStartupMessages(library(tidyverse))
library(brms)
library(glue)

dat <- read_csv("data/virus_in_silenced.csv")
```


```{r cache=TRUE}
brmModel <- brm(bf(RQ ~ Treatment:Experiment:Gene+0, sigma ~ Treatment + Experiment + Gene), family = student, data = filter(dat, RQ<30), cores = 4, iter = 10000)
```

```{r}
summary(brmModel)

hypotheses <- data.frame()
for (gene in unique(dat$Experiment))
  for (virus in unique(dat$Gene)) {
    hyp <- hypothesis(brmModel, glue("TreatmentSilenced:Experiment{gene}:Gene{virus} < TreatmentControl:Experiment{gene}:Gene{virus}"))
    hyp$hypothesis$test <- paste(gene, virus)
    hypotheses <- rbind(hypotheses, hyp$hypothesis)
  }
    
hypotheses[,c("test", "Estimate", "Post.Prob", "Star")]

filter(dat, Experiment == "CuP8_exp" & Gene == "VDV2" & RQ<30) %>% ggplot(aes(Treatment, RQ)) + geom_boxplot()

filter(dat, Experiment == "CuP8_exp" & Gene == "ARV2" & RQ<30) %>% ggplot(aes(Treatment, RQ)) + geom_boxplot()

```
